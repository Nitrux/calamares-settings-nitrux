#! /bin/bash

set -x

### (force) Add kwin rules for calamares

xdg_file_path="$HOME/.config"

[ -f $xdg_file_path/kwinrulesrc ] && {
    rm $xdg_file_path/kwinrulesrc 
    } || {
    touch "$xdg_file_path/kwinrulesrc"
}

>> "$xdg_file_path/kwinrulesrc" printf "%s\n" \
    '[1]' \
    'Description=Calamares'
    'above=true' \
    'aboverule=2' \
    'desktopfile=io.calamares.calamares' \
    'desktopfilerule=3' \
    'fullscreen=true' \
    'fullscreenrule=2' \
    'position=-2,30' \
    'positionrule=0' \
    'types=1' \
    'wmclass=calamares calamares' \
    '' \
    '[9d397d2b-c7ed-4ac3-867f-5b918335d06d]' \
    'Description=Cask' \
    'below=true' \
    'belowrule=2' \
    'fullscreen=true' \
    'fullscreenrule=2' \
    'noborder=true' \
    'noborderrule=2' \
    'title=Cask' \
    'titlematch=1' \
    'types=1' \
    'wmclass=cask' \
    'wmclasscomplete=true' \
    'wmclassmatch=1' \
    '' \
    '[General]' \
    'count=2' \
    'rules=1,9d397d2b-c7ed-4ac3-867f-5b918335d06d' \
    ''

sleep 1

#   restart kwin otherwise rules aren't loaded

if pgrep -x "kwin_x11" > /dev/null
    then
        kwin_x11 --replace &
    else
        kwin_wayland --replace &
fi

sleep 1

exit 0
