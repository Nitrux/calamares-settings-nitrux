#! /bin/bash

set -x


### (force) Add kwin rules for calamares

sleep 2

user_xdg_path="$HOME/.config"

>> "$user_xdg_path/kwinrulesrc" printf "%s\n" \
    '' \
    '[3]' \
    'Description=Calamares' \
    'desktopfile=io.calamares.calamares' \
    'desktopfilerule=3' \
    'fullscreen=true' \
    'fullscreenrule=3' \
    'position=-2,30' \
    'positionrule=0' \
    'types=1' \
    'wmclass=calamares calamares' \
    ''

sed -i 's+count=2+count=3+g' "$user_xdg_path"/kwinrulesrc
sed -i 's+rules=1,2+rules=1,2,3+g' "$user_xdg_path"/kwinrulesrc

sleep 1


#   restart kwin otherwise rules aren't loaded

if pgrep -x "kwin_x11" > /dev/null
    then
        kwin_x11 --replace &
fi

sleep 1

exit 0
